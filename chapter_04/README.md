# Chapter 04. 좋은 단위 테스트의 4대 요소
- - -

## 좋은 단위 테스트의 4대 요소 
* 회귀 방지
* 리팩터링 내성
* 빠른 피드백
* 유지 보수성 

### 회귀 방지
* 회귀는 소프트웨어 버그다. 코드를 수정한 후 기능이 의도한 대로 작동하지 않는 경우다.
* 회귀 방지 지표에 대한 테스트 점수가 얼마나 잘 나오는지 평가하려면 다음 사항을 고려해야 한다.
  * 테스트 중에 실행되는 코드의 양
  * 코드 복잡도
  * 코드의 도메인 유의성
* 일반적으로 실행되는 코드가 많을수록 테스트에서 회귀가 나타날 가능성이 높다.
  * 코드가 예외를 발생시키지 않고 실행된다는 것을 아는 데 도움은 되지만, 코드가 생성하는 결과가 유효한지도 확인해야 한다.
* 단순한 코드를 테스트하는 것은 가치가 없다.
* 회귀 방지 지표를 극대화하려면 테스트가 가능한 한 많은 코드를 실행하는 것을 목표로 해야 한다.

### 리팩터링 내성
* 테스트를 빨간색(실패)으로 바꾸지 않고 기본 애플리케이션 코드를 리팩터링할 수 있는지에 대한 척도다.
* 리팩터링은 식별할 수 있는 동작을 수정하지 않고 기존 코드를 변경하는 것이다.
  * 코드의 비기능적인 특징을 개선하여 가독성을 높이고 복잡도를 낮추기 위함이다.
* 테스트가 지속 가능한 성장을 하게 하는 메커니즘은 회귀 없이 주기적으로 리팩터링하고 새로운 기능을 추가할 수 있는 것이다. 이는 두 가지 장점이 존재한다.
  * 기존 기능이 고장 났을 때 테스트가 조기 경고를 제공한다.
  * 코드 변경이 회귀로 이어지지 않을 것이라고 확신할 수 있다.
* 실제로 기능이 의도한 대로 작동하지만 테스트는 실패하는 경우를 거짓 양성이라고 한다.
  * 거짓 양성은 테스트 스위트에 대한 신뢰를 떨어지게 한다.

### 거짓 양성의 원인
* 테스트와 테스트 대상 시스템의 구현 세부 사항이 많이 결합할수록 허위 경보가 더 많이 생긴다.
* 거짓 양성이 생길 가능성을 줄이는 방법은 해당 구현 세부 사항에서 테스트를 분리하는 것뿐이다.
  * 테스트가 SUT가 생성한 결과가 아니라 SUT의 세부 구현 사항과 결합하지 않도록 한다.
  * 테스트가 똑같이 적용할 수 있는 다른 구현을 고려하지 않고 특정 구현만 예상해서 알고리즘을 검사하지 않도록 해야 한다.

## 특성 간의 본질적인 관계
* 프로젝트가 시작된 직후에는 회귀 방지를 훌륭히 갖추는 것이 중요한데 반해, 리팩터링 내성은 바로 필요하지 않다.

### 테스트 정확도 극대화
* 코드 정확도와 테스트 결과에 대해서는 네 가지 결과가 있을 수 있다.
  * 테스트는 통과하거나 실패하고, 기능이 잘 작동하거나 고장 날 수도 있다.
* 테스트가 통과하고 기본 기능이 의도한 대로 잘 작동하는 상황은 올바른 추론이다. (참 음성)
* 기능이 고장 나서 테스트가 실패하면 올바른 추론이다. (참 양성)
* 기능은 고장 났지만 테스트는 통과하면 문제가 된다. (거짓 음성)
  * 거짓 음성을 회피하는 데 좋은 테스트의 첫 번째 특성인 회귀 방지가 도움이 된다.
* 기능은 올바르지만 테스트가 실패로 표시되는 경우에는 거짓 양성으로 허위 경보다.
  * 거짓 양성을 피하는 데 두 번째 특성인 리팩터링 내성이 도움이 된다.
* 테스트의 맥락에서 긍정은 어떤 조건이 사실임을 의미한다. 즉, 테스트는 전체적인 상황을 바라보지 않는다.
* 회귀 방지와 리팩터링 내성은 테스트 스위트의 정확도를 극대화하는 것을 목표로 한다.
  * 테스트가 버그 있음을 얼마나 잘 나타내는가 (거짓 음성 제외)
  * 테스트가 버그 없음을 얼마나 잘 나타내는가 (거짓 양성 제외)
* 테스트 정확도 = 신호(발견된 버그 수) / 소음(허위 경보 발생 수)
  * 테스트 정확도를 향상 시키는 방법은 신호를 증가시키거나 소음을 줄이는 것이다.
  * 즉 회귀를 더 잘 찾아내는 테스트로 개선하거나, 허위 경보를 발생시키지 않는 테스트로 개선하는 것이다.

## 빠른 피드백과 유지 보수성
* 오래 걸리는 테스트는 자주 실행하지 못하기 때문에 잘못된 방향으로 가면서 시간을 더 많이 낭비하게 된다.
* 유지 보수성 지표는 유지비를 평가하는데, 다음 두 가지 주요 요소로 구성된다.
  * 테스트가 얼마나 어려운가
    * 이 구성 요소는 테스트의 크기와 관련이 있다.
    * 테스트는 코드 라인이 적을수록 더 읽기 쉽다.
    * 작은 테스트는 필요할 때 변경하는 것도 쉽다.
  * 테스트가 얼마나 실행하기 어려운가
    * 테스트가 프로세스 외부 종속성으로 작동하면, 데이터베이스 서버를 재부팅하고 네트워크 연결 문제를 해결하는 등 의존성을 상시 운영하는 데 시간을 들여야 한다.

## 이상적인 테스트를 찾아서
* 좋은 단위 테스트의 4대 특성
  * 회귀 방지
  * 리팩터링 내성
  * 빠른 피드백
  * 유지 보수성

### 이상적인 테스트
* 이상적인 테스트는 네 가지 특성 모두에서 최대 점수를 받는 테스트다.
* 하지만 이상적인 테스트는 처음 세 가지 특성인 회귀 방지, 리팩터링 내성, 빠른 피드백이 상호 배타적이기 때문에 불가능하다.
  * 셋 중 하나를 희생해야 나머지 둘을 최대로 할 수 있다.
* 단위 테스트의 4대 특성에서 하나라도 0점을 받는 테스트는 가치가 없다. 따라서 특성 중 어느 것도 크게 줄이지 않는 방식으로 최대한 크게 해야 한다.